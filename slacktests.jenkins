def sendSlackNotification(String slackMessage) {
  script {
    def color = 'danger'
    echo "[LOG] currentBuild.result: ${currentBuild.result}"
    echo "[LOG] currentBuild.currentResult: ${currentBuild.currentResult}"

    if (currentBuild.currentResult == 'SUCCESS') {
      color = 'good'
    } else if (currentBuild.currentResult == 'FAILURE') {
      color = 'warning'
    }

    slackSend color: color, message: "${env.JOB_NAME} ${env.BUILD_NUMBER} ${slackMessage} (<${env.BUILD_URL}>|Open>)"
  }
}

pipeline {
  agent any

  stages {

    stage ('Tests') {
      steps {
        echo "[INLINE LOG] currentBuild.result: ${currentBuild.result}"
        echo "[INLINE LOG] currentBuild.currentResult: ${currentBuild.currentResult}"
      }

      post {
        always {
          sendSlackNotification 'Reporting job status in post step.'
          echo "[INLINE LOG] currentBuild.result: ${currentBuild.result}"
          echo "[INLINE LOG] currentBuild.currentResult: ${currentBuild.currentResult}"
        }
      }
    }

  }
}