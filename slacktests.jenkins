def sendSlackNotification(String message) {
  script {
    def color = 'warning'

    if (currentBuild.result == 'STARTED') {
      color = 'danger'
    } else if (currentBuild.result == 'SUCCESSFUL') {
      color = 'good'
    }

    slackSend color: color, message: message
  }
}

pipeline {

  stages {

    stage ('Tests') {
      steps {
        sendSlackNotification 'Started the job. Will send another notification in 10 seconds.'

        sleep time: 10, unit: 'SECONDS'

        sendSlackNotification 'Finishing the job. Please wait for the final empty message.'
      }

      post {
        always {
          sendSlackNotification 'Reporting job status in post step.'
        }
      }
    }

  }
}